<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="userEtcMapper">

<!-- 기본 CommunityDTO ResultMap -->
<resultMap type="communityDTO" id="communityResultMap">
	<id column="community_no" property="no"/>
	<result column="community_name" property="name"/>
	<result column="community_profile" property="profile"/>
	<result column="community_desc" property="desc"/>
	<result column="community_register_date" property="registerDate"/>
	<result column="community_state" property="state"/>
	<!-- oftype : myreplay 여러개를 replies에 저장한다 -->
	<collection property="replies" ofType="communityCommentDTO">
		<id column="community_comment_no" property="no"/>
		<result column="community_comment_content" property="content"/>
		<result column="community_comment_register" property="registerdate"/>
		<result column="member_email" property="email"></result>
	</collection>
</resultMap>

<resultMap type="qnaDTO" id="qnaResultMap">
	<id column="qna_no" property="no"/>
	<result column="qna_name" property="name"/>
	<result column="qna_desc" property="desc"/>
	<result column="qna_pwd" property="pwd"/>
	<result column="qna_register_date" property="registerdate"/>
	<result column="member_email" property="email"/>
	<result column="qna_qnaParent" property="qnaParent"/>
</resultMap>

<resultMap type="producerDTO" id="producerResultMap">
	<id column="producer_no" property="no"/>
	<result column="producer_name" property="name"/>
	<result column="producer_addr" property="addr"/>
	<result column="producer_phone" property="phone"/>
	<result column="producer_register_date" property="registerDate"/>
	
	<association property="productDto" javaType="productDTO">
		<id column="product_no" property="no"/>
		<result column="product_profile" property="profile"/>
	</association>
</resultMap>

<resultMap type="communityCommentDTO" id="communityCommentResultMap">

</resultMap>

<!-- 1. 모임목록 불러오기  -->
<!-- 	1-1.6개의 현재 진행하는 행사를 가져온다. -->
<!-- <select id="getCommunityIng" resultMap="communityResultMap" parameterType="communityDTO">
	SELECT * FROM community WHERE rownum <= 6 and #{community_state}= 0
</select> -->

<!-- 	1-2.3개의 과거진행하는 행사를 가져온다. -->
<!-- <select id="getCommunityPast" resultMap="communityResultMap" parameterType="communityDTO">
	SELECT * FROM community WHERE rownum <= 6 and #{community_state}= 1
</select> -->

<!-- 2. 모임 상세 보기 -->
<!-- 2-1. 처음에 보여질 모임에 해당하는 profile 사진을 업로드 한다. 
	request에서 넘어오는 community_no정보를 받아 그 번호에 해당하는 prfile이미지를 불러온다.
-->
<select id="getCommunityProfile" resultType="String" parameterType="int">
	select community_profile from community where community_no=#{value}
</select>

<!-- 2-2. 화면 밑에는 댓글에 해당하는 댓글 내용이 다 출력되어진다. -->
<select id="getCommunityComment" resultMap="communityCommentResultMap" parameterType="int">
	select *
	from community_comment,community
	where community.community_no=#{value} and community.community_no=community_comment.community_no;
</select>

<!-- 2-3. 1-1을 다시 불러온다 -->

<!-- 3. Q&A게시판 클리하면 Q&A목록 불러오기-->
<!-- 3.1 Q&A에 있는 목록을 다 가져온다. -->
<select id="qnaLoading" resultMap="qnaDTO">
	select * from qna order by qna_no desc	
</select>

<!-- 3.2 Q&A에 해당하는 email에 Q&A 목록 리스트가 올라가고, 전체 Q&A에도 들어간다. -->
<insert id="registerQnA" parameterType="qnaDTO">
	insert into qna values(#{no}, #{name}, #{desc}, #{pwd}, #{registerdate}, #{email}, #{qnaParent} ) where member_email=#{email}
</insert>

<!-- 4. 정보 게시판을 누르면 정보에 대한 내용을 모두 가져온다 -->
<select id="infoLoading" resultMap="infomationDTO">
	select * from information order by information_no desc
</select>

<!-- 5. 특정 게시판을 누르면 상세 정보를 가져온다. -->
<select id="infoDetail" resultMap="infomationDTO" parameterType="int">
	select * from information where information_no=#{no}
</select>

<!-- 6. 기부 정보를 모두 가져온다. -->
<select id="donationLoading" resultMap="infomationDTO" parameterType="int">
	select * from donation 
</select>


<!-- 7. 생산자 상세보기 불러오기 -->
<!-- 7.1 생산자 정보를 불러온다. -->
<select id="producerDetail" resultMap="producerResultMap" parameterType="int">
	select producer.producer_name, producer.producer_addr, producer.producer_phone, producer.producer_register_date
	from producer
	where producer.producer_no=#{value}
	
</select>
		
<!-- 7.2 생산자 정보에 해당하는 대표 상품 한가지만 가져온다. 생산자 정보에 해당하는 제품(productDTO)를 받는다.-->
<select id="producerBest" resultMap="producerResultMap" parameterType="int">
	select product.product_profile
	from producer,product
	where producer.producer_no=#{value} and producer.producer_no=product.producer_no;
</select>


</mapper>